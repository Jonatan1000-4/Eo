<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Pel√≠culas - EMTV</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, sans-serif;
      background: linear-gradient(135deg, #0b1c2e, #0e243b);
      color: #fff;
    }

    header {
      text-align: center;
      padding: 20px;
      font-size: 2rem;
      font-weight: bold;
      background: #0e243b;
      box-shadow: 0 2px 12px rgba(0,0,0,.5);
    }

    .catalogo {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 20px;
      padding: 20px;
    }

    .card {
      background: #111820;
      border: 1px solid #2a3a4d;
      border-radius: 10px;
      overflow: hidden;
      cursor: pointer;
      transition: transform .3s ease, box-shadow .3s ease;
    }

    .card:hover {
      transform: translateY(-8px) scale(1.03);
      box-shadow: 0 0 18px rgba(0,170,255,.5);
      border-color: #00aaff;
    }

    .card img {
      width: 100%;
      height: 260px;
      object-fit: cover;
      background: #000;
    }

    .card-body {
      padding: 12px;
    }

    .card-body h3 {
      font-size: 1rem;
      margin: 0 0 6px;
    }

    .card-body p {
      font-size: 0.8rem;
      color: #ccc;
      height: 38px;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* Pantalla de reproducci√≥n */
    #playerScreen {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: #000;
      z-index: 1000;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }

    #playerVideo {
      width: 100%;
      height: 100%;
      object-fit: contain;
      background: #000;
    }

    /* Overlay estilo Netflix */
    #playerOverlay {
      position: absolute;
      top: 0; left: 0;
      width: 100%;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px;
      background: linear-gradient(to bottom, rgba(0,0,0,.7), transparent);
      z-index: 2000;
    }

    #playerTitle {
      font-size: 1.2rem;
      font-weight: bold;
    }

    .overlay-buttons button {
      margin-left: 10px;
      background: rgba(15, 25, 35, 0.9);
      border: 1px solid #00aaff;
      color: #fff;
      padding: 8px 12px;
      border-radius: 6px;
      cursor: pointer;
      transition: background .2s ease;
    }

    .overlay-buttons button:hover {
      background: #00aaff;
      color: #000;
    }

    /* Panel lateral de configuraci√≥n */
    #configMenu {
      position: fixed;
      top: 0;
      right: -320px; /* oculto por defecto */
      width: 300px;
      height: 100%;
      background: #1c222b;
      border-left: 2px solid #00aaff;
      box-shadow: -4px 0 20px rgba(0,170,255,0.4);
      padding: 20px;
      transition: right 0.3s ease;
      z-index: 2200;
    }

    #configMenu.open { right: 0; }

    #configMenu h4 {
      margin-top: 0;
      font-size: 1.2rem;
      border-bottom: 1px solid #2a3a4d;
      padding-bottom: 10px;
      margin-bottom: 15px;
    }

    #configMenu label {
      display: block;
      margin: 10px 0;
      font-size: 0.95rem;
      cursor: pointer;
    }

    #closeConfig {
      position: absolute;
      top: 10px; right: 10px;
      font-size: 1.4rem;
      cursor: pointer;
      color: #fff;
    }

    #closeConfig:hover { color: #00aaff; }
  </style>
</head>
<body>
  <header>üé¨ Cat√°logo de Pel√≠culas</header>

  <div class="catalogo" id="catalogoPeliculas"></div>

  <!-- Pantalla de Reproducci√≥n -->
  <div id="playerScreen">
    <div id="playerOverlay">
      <div id="playerTitle">Pel√≠cula</div>
      <div class="overlay-buttons">
        <button id="btnVolver">‚è™ Volver</button>
        <button id="btnConfig">‚öôÔ∏è Configuraci√≥n</button>
      </div>
    </div>
    <video id="playerVideo" controls autoplay></video>
  </div>

  <!-- Configuraci√≥n (panel lateral) -->
  <div id="configMenu">
    <span id="closeConfig">&times;</span>
    <h4>Configuraci√≥n</h4>
    <label><input type="radio" name="playerMode" value="hls" checked> Reproductor HLS.js</label>
    <label><input type="radio" name="playerMode" value="native"> Reproductor Nativo</label>
    <br>
    <label><input type="radio" name="fitMode" value="contain" checked> Ajustar (Contain)</label>
    <label><input type="radio" name="fitMode" value="cover"> Pantalla Completa (Cover)</label>
    <label><input type="radio" name="fitMode" value="fill"> Estirar (Fill)</label>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <script>
    const m3uUrl = "https://jonatan1000-4.github.io/mi_app_rv22/uiux.html";
    const epgUrl = "https://jonatan1000-4.github.io/mi_app_rv22/xmltv.xml";

    let currentStream = null;
    let hls = null;
    let epgDoc = null;

    async function cargarEPG() {
      const res = await fetch(epgUrl);
      const xml = await res.text();
      epgDoc = new DOMParser().parseFromString(xml, "application/xml");
    }

    function getDescripcion(channelId) {
      if (!epgDoc) return null;
      const programas = epgDoc.getElementsByTagName("programme");
      for (let prog of programas) {
        if (prog.getAttribute("channel") === channelId) {
          let desc = prog.getElementsByTagName("desc");
          if (desc.length > 0) return desc[0].textContent;
        }
      }
      return null;
    }

    async function cargarM3U(url, callback) {
      const txt = await (await fetch(url)).text();
      callback(parsearM3U(txt));
    }

    function parsearM3U(texto) {
      const lineas = texto.split(/\r?\n/);
      const lista = [];
      for (let i = 0; i < lineas.length; i++) {
        let l = lineas[i].trim();
        if (l.startsWith("#EXTINF")) {
          let nombre = l.split(",").pop().trim();
          let logo="", id="";
          let mLogo=/tvg-logo="([^"]*)"/.exec(l); if(mLogo) logo=mLogo[1];
          let mId=/tvg-id="([^"]*)"/.exec(l); if(mId) id=mId[1];
          let url=lineas[i+1] ? lineas[i+1].trim() : "";
          if(url.startsWith("http")){
            lista.push({nombre, logo, id, url});
          }
        }
      }
      return lista;
    }

    function mostrarPeliculas(lista) {
      const cont = document.getElementById("catalogoPeliculas");
      cont.innerHTML = "";
      lista.forEach(p => {
        let descripcion = p.id ? getDescripcion(p.id) : null;
        let card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
          <img src="${p.logo || 'https://via.placeholder.com/300x400/000000/ffffff?text=Sin+Imagen'}" alt="${p.nombre}">
          <div class="card-body">
            <h3>${p.nombre}</h3>
            <p>${descripcion || 'Sin descripci√≥n disponible.'}</p>
          </div>
        `;
        card.onclick = () => reproducirPelicula(p, descripcion);
        cont.appendChild(card);
      });
    }

    function reproducirPelicula(p, descripcion) {
      document.querySelector("header").style.display = "none";
      document.getElementById("catalogoPeliculas").style.display = "none";
      document.getElementById("playerScreen").style.display = "flex";
      document.getElementById("playerTitle").textContent = p.nombre + (descripcion ? " ‚Äì " + descripcion : "");
      currentStream = p.url;
      iniciarReproductor();
    }

    function iniciarReproductor() {
      const video = document.getElementById("playerVideo");
      video.src = "";
      if (hls) { hls.destroy(); hls = null; }

      const playerMode = document.querySelector("input[name='playerMode']:checked").value;
      if (playerMode === "hls" && Hls.isSupported()) {
        hls = new Hls();
        hls.loadSource(currentStream);
        hls.attachMedia(video);
      } else {
        video.src = currentStream;
      }

      aplicarFitMode();
      video.play();
    }

    function aplicarFitMode() {
      const video = document.getElementById("playerVideo");
      const fitMode = document.querySelector("input[name='fitMode']:checked").value;
      video.style.objectFit = fitMode;
    }

    document.getElementById("btnVolver").addEventListener("click", () => {
      const video = document.getElementById("playerVideo");
      video.pause(); video.src = "";
      if (hls) { hls.destroy(); hls = null; }
      document.getElementById("playerScreen").style.display = "none";
      document.querySelector("header").style.display = "block";
      document.getElementById("catalogoPeliculas").style.display = "grid";
    });

    document.getElementById("btnConfig").addEventListener("click", () => {
      document.getElementById("configMenu").classList.add("open");
    });

    document.getElementById("closeConfig").addEventListener("click", () => {
      document.getElementById("configMenu").classList.remove("open");
    });

    document.querySelectorAll("input[name='playerMode']").forEach(el => {
      el.addEventListener("change", iniciarReproductor);
    });

    document.querySelectorAll("input[name='fitMode']").forEach(el => {
      el.addEventListener("change", aplicarFitMode);
    });

    // Inicializar
    (async function(){
      await cargarEPG();
      cargarM3U(m3uUrl, mostrarPeliculas);
    })();
  </script>
</body>
</html>
